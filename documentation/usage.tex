\section{Using ASAGI}

\subsection{Minimal examples}

These are minimal C, C++ and FORTRAN examples that load a 2-dimensional grid and print the value at (0,0). In each case the grid consists of floating point values.

\lstinputlisting[language=c,caption={Minimal C example}]{minimal.c}

\lstinputlisting[language=c++,caption={Minimal C++ example}]{minimal.cpp}

\lstinputlisting[language=fortran,caption={Minimal FORTRAN example}]{minimal.f90}

\subsection{Dimensions}

ASAGI supports grids with up to three dimensions. The number of dimension cannot be specified by calling an ASAGI function but depends on the NetCDF input file. To access values of an $n$-dimensional grid (with $n\in\{1,2,3\}$), use any of the \texttt{get\_$n$d} functions.

\subsection{Level of detail}

A grid can have multiple resolutions. Each resolution is identified by a level id (level of detail). You can omit the level arguments if you have a grid with only one resolution\footnote{Since C does not support default arguments or overloading, omitting arguments is not possible when using the C interface.}.

To use a grid with multiple levels, you have to specify the number of levels when creating the grid. To load the different levels, call \texttt{open} once for each level. Several levels can be stored in a single NetCDF file with different variable names (check section $TODO$ on how to set the variable name). The most coarsen resolution should have the level id 0. With ascending level id, the resolution should get finer. When accessing values with any \texttt{get} function, the level of detail can be selected with the last argument. \texttt{Close} has to be called only once for the whole grid.

\subsection{Coordinate mapping}

ASAGI distinguishes between actual coordinates and internal array indexes. All \texttt{getValue} functions expect actual coordinates. ASAGI maps each coordinate to the nearest array index using the coordinate variables from the NetCDF file (see section \ref{sec:netcdf files} on how specify coordinate variables in NetCDF files). If no coordinate variable is available, ASAGI uses a one-to-one mapping from coordinates to array indexes.

The actual range of the grid can be obtained with the \texttt{getMin}/\texttt{getMax} functions. They also return coordinates, not array indexes. It is erroneous to access values outside range of the grid.

The range of a dimension can be $\infty$. This is the case if the size of the dimension in the NetCDF file is one.

\subsection{Value position}

ASAGI supports cell-centered and vertex-centered grids as shown in figure \ref{fig:cell-centered vertex-centered}. The value position can be switched with the \texttt{setParam} function (see section $TODO$).

\begin{figure}[h]
 \def\xwidth{7}
 \def\ywidth{5}
 \def\scale{0.7}
 \centering
 \subfloat[Cell-centered]{\input{images/cell-centered}} \qquad
 \subfloat[Vertex-centered]{\input{images/vertex-centered}}
 \caption{Cell-centered and vertex-centered grids}
 \label{fig:cell-centered vertex-centered}
\end{figure}


\subsection{NetCDF files}
\label{sec:netcdf files}

All NetCDF files opened with ASAGI should respect the COARDS conventions\footnote{\url{http://ferret.wrc.noaa.gov/noaa_coop/coop_cdf_profile.html}}. However, ASAGI has some further limitations:
\begin{itemize}
 \item The attributes \texttt{scale\_factor} and \texttt{add\_offset} are ignored. Besides conversion between data types, ASAGI does not modify the values.
 \item Since ASAGI does not change the NetCDF file, all values have to be present in the file. Attributes, like \texttt{\_FillValue} and \texttt{missing\_value}, are not supported.
 \item ASAGI is not aware of any units. It is up to the user of the library to interpret the values correctly.
 \item Variables with more than three dimensions are not supported.
\end{itemize}

It is possible to open a NetCDF file multiple times with different grid instances. This allows you, for example, to store several grids in a single NetCDF file distinguished by the variable name.

\input{interface}